{"version":3,"sources":["snow.js"],"names":["_document$getElementB","snowConf","isSnowing","requestAnimationFrame","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","canvas","document","getElementById","ctx","getContext","flakeCount","mX","mY","flakes","width","innerWidth","height","innerHeight","snow","clearRect","minDist","i","flake","x","y","x2","y2","dist","Math","sqrt","xcomp","ycomp","deltaV","velX","velY","speed","cos","step","stepSize","fillStyle","opacity","reset","beginPath","arc","size","PI","fill","floor","random","startSnow","push","angle","addEventListener","e","clientX","clientY","localStorage","setItem","classList","add","removeItem","remove","_window$kr","getItem","kr","notMobile","init"],"mappings":"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","file":"../js/snow.min.js","sourcesContent":["(()=>{\n    // 设置雪花参数\n    let snowConf = {\n        flakeCount: 100,\n        minDist: 150,\n        color: \"255, 255, 255\",\n        size: 2,\n        speed: 0.5,\n        opacity: 0.3,\n        stepsize: .5,\n    };\n\n    // 记录下雪状态\n    let isSnowing = true;\n\n    const requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || function(callback){window.setTimeout(callback, 1000/60);};\n    window.requestAnimationFrame = requestAnimationFrame;\n    const canvas = document.getElementById(\"snow\");\n    const ctx = canvas.getContext(\"2d\");\n    const flakeCount = snowConf.flakeCount;\n    let mX = -100, mY = -100;\n    let flakes = [];\n    canvas.width = window.innerWidth;\n    canvas.height = window.innerHeight;\n    const snow = () => {\n        if (!isSnowing) {\n            return; // 结束\n        }\n\n        // 清空画布\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        const minDist = snowConf.minDist;\n        for (let i = 0; i < flakeCount; i++){\n            let flake = flakes[i];\n            const x = mX, y = mY;\n            const x2 = flake.x, y2 = flake.y;\n            const dist = Math.sqrt((x - x2)*(x - x2) + (y - y2)*(y - y2));\n            if (dist < minDist) {\n                const force  = minDist / (dist*dist);\n                const xcomp  = (x - x2) / dist;\n                const ycomp  = (y - y2) / dist;\n                const deltaV = force / 2;\n                flake.velX -= deltaV * xcomp;\n                flake.velY -= deltaV * ycomp;\n             } else {\n                flake.velX *= 0.98;\n                if (flake.velY < flake.speed && (flake.speed - flake.velY > .01)) {\n                    flake.velY += (flake.speed - flake.velY) * .01;\n                }\n                flake.velX += Math.cos(flake.step += .05) * flake.stepSize;\n            }\n            ctx.fillStyle = \"rgba(\" + snowConf.color + \", \" + flake.opacity + \")\";\n            flake.y += flake.velY;\n            flake.x += flake.velX;\n            if(flake.y >= canvas.height || flake.y <= 0){\n                reset(flake);\n            }\n            if(flake.x >= canvas.width || flake.x <= 0){\n                reset(flake);\n            }\n            ctx.beginPath();\n            ctx.arc(flake.x, flake.y, flake.size, 0, Math.PI*2);\n            ctx.fill();\n        }\n        requestAnimationFrame(snow);\n    };\n    const reset = (flake)=>{\n        flake.x       = Math.floor(Math.random()*canvas.width);\n        flake.y       = 0;\n        flake.size    = (Math.random()*3)+2;\n        flake.speed   = (Math.random()*1)+0.5;\n        flake.velY    = flake.speed;\n        flake.velX    = 0;\n        flake.opacity = (Math.random()*0.5)+0.3;\n    };\n    // 初始化函数\n    const init = () => {\n        // 判断当前是否应该下雪\n        const isSnowDisabled = localStorage.getItem('kr-disable-snow') !== null;\n        if (isSnowDisabled || window.kr?.notMobile === false) {\n            // 用户禁用了或者是移动端，就不下雪了\n            isSnowing = false;\n            canvas.classList.add('disabled');\n            return;\n        }\n\n        startSnow();\n    };\n    const startSnow = () => {\n        // 生成初始雪花\n        for (let i = 0; i < flakeCount; i++) {\n            const x       = Math.floor(Math.random()*canvas.width);\n            const y       = Math.floor(Math.random()*canvas.height);\n            const size    = (Math.random()*3) + snowConf.size;\n            const speed   = (Math.random()*1) + snowConf.speed;\n            const opacity = (Math.random()*0.5) + snowConf.opacity;\n            flakes.push({\n                speed: speed,\n                velX: 0, velY: speed,\n                x: x, y: y,\n                size: size,\n                stepSize: (Math.random()) / 30 * snowConf.stepsize,\n                step: 0,\n                angle: 180,\n                opacity: opacity\n            });\n        }\n        // 开始下雪\n        snow();\n    };\n    // 雪花避让鼠标\n    document.addEventListener(\"mousemove\", (e)=>{mX = e.clientX, mY = e.clientY});\n    // 窗口大小调整\n    window.addEventListener(\"resize\",()=>{canvas.width = window.innerWidth; canvas.height = window.innerHeight;});\n    // 监听下雪状态改变事件\n    document.getElementById(\"snow-switch\")?.addEventListener(\"click\", () => {\n        // 下雪状态按钮被点击，切换下雪状态\n        if (isSnowing) {\n            // 停停停\n            setTimeout(() => {\n                // 让淡化动画播放完成后再停止\n                isSnowing = false;\n            }, 600);\n            localStorage.setItem('kr-disable-snow', true);\n            canvas.classList.add('disabled');\n        } else {\n            // 来了来了\n            isSnowing = true;\n            localStorage.removeItem('kr-disable-snow');\n            canvas.classList.remove('disabled');\n\n            startSnow();\n        }\n    });\n\n    // 初始化\n    init();\n})();"]}